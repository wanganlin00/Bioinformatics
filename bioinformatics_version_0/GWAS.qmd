# 全基因组关联研究GWAS

全基因组关联分析（Genome Wide Association Study，GWAS）是指在全基因组层面上，开展多中心、大样本、反复验证的基因与疾病的关联研究，是通过对大规模的群体DNA样本进行全基因组高密度遗传标记（如单核苷酸多态性SNP或CNV等）分型，进而将基因型与可观测的性状，即表型，进行群体水平的统计学分析，根据统计量或显著性 p 值筛选出最有可能影响该性状的遗传变异（标记），全面揭示疾病发生、发展与治疗相关的遗传基因

GWAS的主要步骤包括：

1.  样本收集：收集足够数量的个体样本，包括患病个体和对照个体。

2.  基因分型：利用高密度的SNP芯片对个体的全基因组进行分型，以获取遗传信息。

3.  质量控制：对基因分型数据进行质量控制，包括去除低质量的SNP位点和样本，校正人群分层等。

4.  统计分析：使用统计方法（如线性回归、逻辑回归等）对每个SNP位点与表型之间的关联进行检验。

5.  结果解释：对统计显著的SNP位点进行解释，以识别可能的疾病相关基因或遗传区域。

6.  验证研究：在独立的样本中对显著的关联结果进行验证，以确认其可靠性。

7.  生物信息学分析：对GWAS结果进行更深入的生物信息学分析，如路径分析、网络分析等，以理解遗传变异如何影响疾病机制。

GWAS的应用： GWAS已被广泛应用于多种复杂疾病的遗传研究，包括但不限于阿尔茨海默病、乳腺癌、糖尿病、冠心病、肺癌、前列腺癌和肥胖等。通过GWAS，科学家们已经鉴定出与这些疾病相关的多个易感基因。

GWAS的挑战和限制： 样本量：GWAS需要非常大的样本量来提高统计功效，确定可复现的全基因组显著关联。 混杂因素：如人群分层、年龄、性别等混杂因素可能影响GWAS的结果。 多重检验：由于测试大量的SNP位点，需要进行多重检验校正，这可能导致错过一些真实的关联信号。 罕见变异：GWAS主要检测常见的遗传变异，对罕见变异的检测能力有限。

GWAS分析模型介绍 GWAS 分析一般会构建回归模型检验标记与表型之间是否存在关联。GWAS中的零假设（H0 null hypothesis）是标记的回归系数为零, 标记对表型没有影响。备择假设(H1，也叫对立假设，Alternative Hypothesis)是标记的回归系数不为零，SNP和表型相关。GWAS中的模型主要分为两种：

一般线性模型GLM(General Linear Model)：y = Xβ + Zα + e，直接将基因型x和表型y做回归拟合。也可以加入群体结果控制假阳性。

![](images/glm.png){fig-align="center"}

GLM模型中，如果两个表型差异很大，但群体本身还含有其他的遗传差异（如地域等），则那些与该表型无关的遗传差异也会影响到相关性。

混合线性模型MLM(Mixed Linear Model)：y = Xβ + Zα + Wμ+ e

y: 所要研究的表型性状；

Xβ：固定效应（Fixed Effect），影响y的其他因素，主要指群体结构；

Zα：标记效应（Marker Effect  SNP）；

Wμ：随机效应（RandomEffect），这里一般指个体的亲缘关系。

MLM模型可以把群体结构的影响设为协方差，把这种位点校正掉。此外，材料间的公共祖先关系也会导致非连锁相关，可加入亲缘关系矩阵作为随机效应来矫正。

FarmCPU：GWAS的瓶颈一是计算速度，二是统计准确性。FarmCPU能提升速度和准确性，首先把随机效应的亲缘关系矩阵（Kinship）转换为固定效应的关联SNP矩阵（S矩阵/QTNs矩阵），使计算速度大大加快；再利用QTN矩阵当做协变量，重新做关联分析，提升准确率。

## [GWASTools](https://bioconductor.org/packages/release/bioc/html/GWASTools.html)

```{r eval=FALSE}
BiocManager::install("GWASTools")
```

-   **GenotypeReader: NcdfGenotypeReader, GdsGenotypeReader, or MatrixGenotypeReader**

-   **IntensityReader: NcdfIntensityReader or GdsIntensityReader**

-   **SnpAnnotationReader: SnpAnnotationDataFrame or SnpAnnotationSQLite**

-   **ScanAnnotationReader: ScanAnnotationDataFrame or ScanAnnotationSQLite**

### 

### GenotypeData 类 和 IntensityData 类

-   Network Common Data Form ([NetCDF](http://www.unidata.ucar.edu/software/netcdf/))

-   Genomic Data Structure ([GDS)](http://corearray.sourceforge.net/)

-   Matrix

### 注释类

`SnpAnnotationDataFrame`和`ScanAnnotationDataFrame`类扩展了**`Biobase`**包中的`AnnotatedDataFrame`类

可移植跨平台类 `SQLite` 类

## 导入

### 纯文本

### Plink

```{r}
library(GWASTools)
library(SNPRelate)
bed.fn <- system.file("extdata", "plinkhapmap.bed.gz", package="SNPRelate")
fam.fn <- system.file("extdata", "plinkhapmap.fam.gz", package="SNPRelate")
bim.fn <- system.file("extdata", "plinkhapmap.bim.gz", package="SNPRelate")
gdsfile <- "snps.gds"
snpgdsBED2GDS(bed.fn, fam.fn, bim.fn, gdsfile, family=TRUE,
              cvt.chr="int", cvt.snpid="int", verbose=FALSE)
```

```{r}
(gds <- GdsGenotypeReader(gdsfile, YchromCode=24L, XYchromCode=25L))
```

## 导出

## CMplot

<https://cran.r-project.org/web//packages/CMplot/index.html>


