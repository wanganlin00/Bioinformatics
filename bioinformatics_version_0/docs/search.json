[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Bioinformatics",
    "section": "",
    "text": "参考资料\n\nOrchestrating Single-Cell Analysis with Bioconductor\nSeurat\nDESeq2\nclusterProfiler、Disease Ontology Semantic and Enrichment analysis\nmonocle2\nhttps://cole-trapnell-lab.github.io/monocle3/\n系统发育树",
    "crumbs": [
      "参考资料"
    ]
  },
  {
    "objectID": "DEGs_Analysis.html",
    "href": "DEGs_Analysis.html",
    "title": "\n5  差异表达基因分析\n",
    "section": "",
    "text": "5.1 数据\n肺腺癌\nLung Adenocarcinoma (LUAD) gene expression RNAseq HTSeq - Counts （n=585） GDC 中心 和Phenotype (n=877)",
    "crumbs": [
      "下游分析",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>差异表达基因分析</span>"
    ]
  },
  {
    "objectID": "DEGs_Analysis.html#assays",
    "href": "DEGs_Analysis.html#assays",
    "title": "\n5  差异表达基因分析\n",
    "section": "\n5.2 Assays",
    "text": "5.2 Assays\n\n5.2.1 对数计数矩阵\n\nCodelibrary(arrow, warn.conflicts = FALSE)\nlogCount &lt;- read_tsv_arrow(\"data/TCGA-LUAD.htseq_counts.tsv.gz\")\n# 读取计数矩阵 log2(count+1)  # 60488 个gene ×  586 个sample\n\n\nlogCount[1:6,1:3]\n\n\n\n\nEnsembl_ID\nTCGA-97-7938-01A\nTCGA-55-7574-01A\n\n\n\nENSG00000000003.13\n10.989394\n9.967226\n\n\nENSG00000000005.5\n4.000000\n0.000000\n\n\nENSG00000000419.11\n10.253847\n9.541097\n\n\nENSG00000000457.12\n9.776433\n9.131857\n\n\nENSG00000000460.15\n7.971544\n8.348728\n\n\nENSG00000000938.11\n8.724514\n9.703904\n\n\n\n\n\n\n\n5.2.2 基因编码文件\n我想要分析总的转录本，不需要把mRNA、lncRNA等挑出来，所以下载的这个自带注释文件ID/Gene Mapping\n\nCodegtf_v22_transcripts &lt;- read_delim(\"data/gencode.v22.annotation.gene.probeMap\")\n\n\n如果只想用蛋白质编码（protein_coding）相关基因，用全基因编码注释文件 gencode.v46.annotation.gtf.gz\n\nCode# 全基因编码  BiocManager::install(\"rtracklayer\")\ngtf_v22 &lt;- rtracklayer::import('data/gencode.v22.annotation.gtf.gz') |&gt;\n as_tibble()\n\ndistinct(gtf_v22,gene_type)\ndistinct(gtf_v22,gene_name)\n\n# 选择 蛋白编码mRNA相关基因\ngtf_v22_mRNA &lt;- dplyr::select(gtf_v22,\n                              c(\"gene_id\",\"gene_type\", \"gene_name\"))|&gt; \n    dplyr::filter(gene_type == \"protein_coding\") |&gt;  \n    distinct()\n\nhead(gtf_v22_mRNA )\nwrite.csv(gtf_v22_mRNA,\"data/gtf_v22_mRNA.csv\")\n\n\n\n5.2.3 根据 ENSEBML 编码内连接\n\nCodegene_logCount &lt;- logCount |&gt; \n  inner_join(gtf_v22_transcripts, by = c(\"Ensembl_ID\" = \"id\")) |&gt; \n  dplyr::select(gene, starts_with(\"TCGA\") )\n\n\n\nCodedim(gene_logCount)\n#&gt; [1] 60483   586\ngene_logCount[1:6,1:3]\n\n\n\n\ngene\nTCGA-97-7938-01A\nTCGA-55-7574-01A\n\n\n\nTSPAN6\n10.989394\n9.967226\n\n\nTNMD\n4.000000\n0.000000\n\n\nDPM1\n10.253847\n9.541097\n\n\nSCYL3\n9.776433\n9.131857\n\n\nC1orf112\n7.971544\n8.348728\n\n\nFGR\n8.724514\n9.703904\n\n\n\n\n\n\n\n5.2.4 还原原始数据\n先去对数 log2(count+1)\n\nCodelibrary(Rcpp)\nRcpp::sourceCpp(\"data/exponential_base2_transform.cpp\")\n\n# 该函数将 `log2(count + 1)` 转换为原始计数\ngene_Count &lt;- gene_logCount %&gt;%\n  mutate_if(is.numeric, ~ exponential_base2_transform(.))\n\n\n基因名是有重复的，查看重复情况\n\nCodegene_Count |&gt; distinct(gene) |&gt; dim()\n#&gt; [1] 58387     1\nrepeat_n &lt;- gene_Count |&gt; summarise(n=n(),.by = gene) |&gt; ungroup() |&gt; \n  summarise(重复n次的基因个数=n(),.by =n ) |&gt; arrange(n)\n# 唯一基因个数\nsum(repeat_n$重复n次的基因个数)\n#&gt; [1] 58387\n\n\n根据基因名分组，重复则取平均值去重，去掉重复的行\n\nCodelibrary(data.table)\nsetDT(gene_Count)\nCounts &lt;- gene_Count[,lapply(.SD,mean),by=gene, .SDcols=patterns(\"^(TCGA)\")]\n\n\n\nCodeCounts &lt;- Counts |&gt; column_to_rownames(\"gene\")\ndim(Counts)\n#&gt; [1] 58387   585\n\n\n\n\n\n\n\n\n\nCodedf &lt;- tibble(\n    g=c('A','B','A','C','C'),\n    x=c(1:5),\n    y=c(3:7),\n    \n)\ndf\n\n\n\n\ng\nx\ny\n\n\n\nA\n1\n3\n\n\nB\n2\n4\n\n\nA\n3\n5\n\n\nC\n4\n6\n\n\nC\n5\n7\n\n\n\n\n\nCode# 数据多太慢了\ndf|&gt; group_by(g) |&gt; summarise_all(list(mean))\n\n\n\n\ng\nx\ny\n\n\n\nA\n2.0\n4.0\n\n\nB\n2.0\n4.0\n\n\nC\n4.5\n6.5\n\n\n\n\n\nCode\n\n# 转化成data.table\n# library(data.table) 非常快\n\nsetDT(df)\n# 对基因g进行分组，并对x和y列计算均值\ndf[, lapply(.SD, mean), by = g, .SDcols = patterns(\"x|y\")]\n\n\n\n\ng\nx\ny\n\n\n\nA\n2.0\n4.0\n\n\nB\n2.0\n4.0\n\n\nC\n4.5\n6.5\n\n\n\n\n\n\n\n\n\n提取lncRNA、miRNA等也是类似的操作",
    "crumbs": [
      "下游分析",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>差异表达基因分析</span>"
    ]
  },
  {
    "objectID": "DEGs_Analysis.html#sample-metadata",
    "href": "DEGs_Analysis.html#sample-metadata",
    "title": "\n5  差异表达基因分析\n",
    "section": "\n5.3 Sample metadata",
    "text": "5.3 Sample metadata\n\n5.3.1 表型注释文件\n\nCode#首先载入下载好胆管癌的样本信息文件\n# 877 个sample × 125 个样本变量\nlibrary(data.table)\ncolData &lt;- fread(\"data/TCGA-LUAD.GDC_phenotype.tsv.gz\", sep = \"\\t\", header = TRUE)\n\n\n# 选择样本  放疗与kras基因\ntable(colData$radiation_therapy,colData$kras_mutation_found)\n#&gt;      \n#&gt;            NO YES\n#&gt;       230   1   3\n#&gt;   NO  491  41  24\n#&gt;   YES  72  11   4\n\npf &lt;- colData |&gt; dplyr::filter(kras_mutation_found!= \"\") |&gt; \n  dplyr::filter(radiation_therapy!= \"\") |&gt; \n  dplyr::select(submitter_id.samples,submitter_id,radiation_therapy,kras_mutation_found)\n\n\nxtabs(formula = ~radiation_therapy+kras_mutation_found,data = pf,subset = NULL)\n#&gt;                  kras_mutation_found\n#&gt; radiation_therapy NO YES\n#&gt;               NO  41  24\n#&gt;               YES 11   4\n\n\n到这里，就从877个样本中挑出了80个样本，但是，我们只要这80个样本中成对样本的表达数据，即同一个病人既有癌旁正常细胞的表达蛋白，又有肿瘤细胞的异常表达蛋白。\n\n5.3.2 colData的成对样本\n\nCodeID &lt;- pf$submitter_id  # 前1~12字符\n\n\n# 21对配对样本\ntable(ID)[table(ID)==2] |&gt; length()\n#&gt; [1] 21\n\nPairedSample &lt;- pf |&gt; summarise(n=n(),.by = \"submitter_id\")|&gt; dplyr::filter(n==2)\nPairedSample \n\n\n\n\nsubmitter_id\nn\n\n\n\nTCGA-50-8457\n2\n\n\nTCGA-55-7913\n2\n\n\nTCGA-55-8089\n2\n\n\nTCGA-44-6148\n2\n\n\nTCGA-50-6593\n2\n\n\nTCGA-99-8028\n2\n\n\nTCGA-50-8459\n2\n\n\nTCGA-50-6594\n2\n\n\nTCGA-50-5936\n2\n\n\nTCGA-55-8205\n2\n\n\nTCGA-49-6744\n2\n\n\nTCGA-50-8460\n2\n\n\nTCGA-49-6742\n2\n\n\nTCGA-99-8033\n2\n\n\nTCGA-49-6745\n2\n\n\nTCGA-91-6848\n2\n\n\nTCGA-50-5066\n2\n\n\nTCGA-50-5935\n2\n\n\nTCGA-J2-8192\n2\n\n\nTCGA-44-6145\n2\n\n\nTCGA-55-7914\n2\n\n\n\n\n\nCodesample &lt;-  left_join(PairedSample,pf,by=join_by(\"submitter_id\"))\nsample\n\n\n\n\n\n\n\n\n\n\n\nsubmitter_id\nn\nsubmitter_id.samples\nradiation_therapy\nkras_mutation_found\n\n\n\nTCGA-50-8457\n2\nTCGA-50-8457-01A\nNO\nYES\n\n\nTCGA-50-8457\n2\nTCGA-50-8457-11A\nNO\nYES\n\n\nTCGA-55-7913\n2\nTCGA-55-7913-01B\nNO\nNO\n\n\nTCGA-55-7913\n2\nTCGA-55-7913-11A\nNO\nNO\n\n\nTCGA-55-8089\n2\nTCGA-55-8089-01A\nNO\nNO\n\n\nTCGA-55-8089\n2\nTCGA-55-8089-11A\nNO\nNO\n\n\nTCGA-44-6148\n2\nTCGA-44-6148-01A\nNO\nNO\n\n\nTCGA-44-6148\n2\nTCGA-44-6148-11A\nNO\nNO\n\n\nTCGA-50-6593\n2\nTCGA-50-6593-01A\nYES\nNO\n\n\nTCGA-50-6593\n2\nTCGA-50-6593-11A\nYES\nNO\n\n\nTCGA-99-8028\n2\nTCGA-99-8028-01A\nNO\nYES\n\n\nTCGA-99-8028\n2\nTCGA-99-8028-11A\nNO\nYES\n\n\nTCGA-50-8459\n2\nTCGA-50-8459-01A\nNO\nYES\n\n\nTCGA-50-8459\n2\nTCGA-50-8459-11A\nNO\nYES\n\n\nTCGA-50-6594\n2\nTCGA-50-6594-01A\nNO\nNO\n\n\nTCGA-50-6594\n2\nTCGA-50-6594-11A\nNO\nNO\n\n\nTCGA-50-5936\n2\nTCGA-50-5936-01A\nNO\nYES\n\n\nTCGA-50-5936\n2\nTCGA-50-5936-11A\nNO\nYES\n\n\nTCGA-55-8205\n2\nTCGA-55-8205-01A\nNO\nNO\n\n\nTCGA-55-8205\n2\nTCGA-55-8205-11A\nNO\nNO\n\n\nTCGA-49-6744\n2\nTCGA-49-6744-01A\nNO\nYES\n\n\nTCGA-49-6744\n2\nTCGA-49-6744-11A\nNO\nYES\n\n\nTCGA-50-8460\n2\nTCGA-50-8460-01A\nYES\nNO\n\n\nTCGA-50-8460\n2\nTCGA-50-8460-11A\nYES\nNO\n\n\nTCGA-49-6742\n2\nTCGA-49-6742-01A\nNO\nNO\n\n\nTCGA-49-6742\n2\nTCGA-49-6742-11A\nNO\nNO\n\n\nTCGA-99-8033\n2\nTCGA-99-8033-01A\nYES\nNO\n\n\nTCGA-99-8033\n2\nTCGA-99-8033-11A\nYES\nNO\n\n\nTCGA-49-6745\n2\nTCGA-49-6745-01A\nNO\nNO\n\n\nTCGA-49-6745\n2\nTCGA-49-6745-11A\nNO\nNO\n\n\nTCGA-91-6848\n2\nTCGA-91-6848-01A\nNO\nNO\n\n\nTCGA-91-6848\n2\nTCGA-91-6848-11A\nNO\nNO\n\n\nTCGA-50-5066\n2\nTCGA-50-5066-01A\nNO\nNO\n\n\nTCGA-50-5066\n2\nTCGA-50-5066-02A\nNO\nNO\n\n\nTCGA-50-5935\n2\nTCGA-50-5935-01A\nYES\nYES\n\n\nTCGA-50-5935\n2\nTCGA-50-5935-11A\nYES\nYES\n\n\nTCGA-J2-8192\n2\nTCGA-J2-8192-01A\nNO\nNO\n\n\nTCGA-J2-8192\n2\nTCGA-J2-8192-11A\nNO\nNO\n\n\nTCGA-44-6145\n2\nTCGA-44-6145-01A\nNO\nNO\n\n\nTCGA-44-6145\n2\nTCGA-44-6145-11A\nNO\nNO\n\n\nTCGA-55-7914\n2\nTCGA-55-7914-01A\nNO\nYES\n\n\nTCGA-55-7914\n2\nTCGA-55-7914-11A\nNO\nYES\n\n\n\n\n\nCodetable(sample$radiation_therapy,sample$kras_mutation_found)\n#&gt;      \n#&gt;       NO YES\n#&gt;   NO  22  12\n#&gt;   YES  6   2\n\n\n\n5.3.3 匹配 assays的成对样本\n并且colData 中出现的成对样本（21对）要匹配到assays 中的成对样本（60对）。（取交集）\n\nCode# 表达矩阵  \npatient_of_counts &lt;- str_sub(colnames(Counts),1,12)\n\n\npaired_patient &lt;- table(patient_of_counts)[table(patient_of_counts)==2]|&gt; \n names()  # 筛选出60对成对数据\npaired_patient |&gt; length()\n#&gt; [1] 60\n\n\n取sample和paired_patient的交集，有8对成对数据\n\nCode# 取交集\nfinal_sample &lt;- lubridate::intersect(sample$submitter_id,paired_patient)\nfinal_sample\n#&gt; [1] \"TCGA-44-6148\" \"TCGA-50-5936\" \"TCGA-49-6744\" \"TCGA-49-6742\" \"TCGA-49-6745\"\n#&gt; [6] \"TCGA-50-5066\" \"TCGA-50-5935\" \"TCGA-44-6145\"\n\nsample &lt;- sample |&gt;\n  dplyr::filter(sample$submitter_id %in% final_sample) |&gt;\n  dplyr::select(-submitter_id, -n) |&gt;\n  dplyr::rename(\"sample_id\" = \"submitter_id.samples\") |&gt;\n  arrange(sample_id)\n\nsample\n\n\n\n\nsample_id\nradiation_therapy\nkras_mutation_found\n\n\n\nTCGA-44-6145-01A\nNO\nNO\n\n\nTCGA-44-6145-11A\nNO\nNO\n\n\nTCGA-44-6148-01A\nNO\nNO\n\n\nTCGA-44-6148-11A\nNO\nNO\n\n\nTCGA-49-6742-01A\nNO\nNO\n\n\nTCGA-49-6742-11A\nNO\nNO\n\n\nTCGA-49-6744-01A\nNO\nYES\n\n\nTCGA-49-6744-11A\nNO\nYES\n\n\nTCGA-49-6745-01A\nNO\nNO\n\n\nTCGA-49-6745-11A\nNO\nNO\n\n\nTCGA-50-5066-01A\nNO\nNO\n\n\nTCGA-50-5066-02A\nNO\nNO\n\n\nTCGA-50-5935-01A\nYES\nYES\n\n\nTCGA-50-5935-11A\nYES\nYES\n\n\nTCGA-50-5936-01A\nNO\nYES\n\n\nTCGA-50-5936-11A\nNO\nYES\n\n\n\n\n\nCodetable(sample$radiation_therapy,sample$kras_mutation_found)\n#&gt;      \n#&gt;       NO YES\n#&gt;   NO  10   4\n#&gt;   YES  0   2\n\n\n\n\n# 最后的表达矩阵\nexprCounts &lt;- Counts  |&gt; dplyr::select(which(colnames(Counts) %in% sample$sample_id)) \n\nexprCounts &lt;- dplyr::select(exprCounts,order(colnames(exprCounts)))\ncolnames(exprCounts)\n#&gt;  [1] \"TCGA-44-6145-01A\" \"TCGA-44-6145-11A\" \"TCGA-44-6148-01A\" \"TCGA-44-6148-11A\"\n#&gt;  [5] \"TCGA-49-6742-01A\" \"TCGA-49-6742-11A\" \"TCGA-49-6744-01A\" \"TCGA-49-6744-11A\"\n#&gt;  [9] \"TCGA-49-6745-01A\" \"TCGA-49-6745-11A\" \"TCGA-50-5066-01A\" \"TCGA-50-5066-02A\"\n#&gt; [13] \"TCGA-50-5935-01A\" \"TCGA-50-5935-11A\" \"TCGA-50-5936-01A\" \"TCGA-50-5936-11A\"\ndim(exprCounts)\n#&gt; [1] 58387    16\n\n# 去除所有样本都不表达的基因\nexprCounts &lt;- exprCounts |&gt;\n    mutate(rowsum = apply(exprCounts,1,sum)) |&gt;\n    dplyr::filter(rowsum!=0) |&gt; \n    dplyr::select(-rowsum)\n\ndim(exprCounts)\n#&gt; [1] 46488    16\n\n\n\nCode# 检查计数矩阵和列数据，看看它们在样本顺序方面是否一致。\ncolnames(exprCounts)\n#&gt;  [1] \"TCGA-44-6145-01A\" \"TCGA-44-6145-11A\" \"TCGA-44-6148-01A\" \"TCGA-44-6148-11A\"\n#&gt;  [5] \"TCGA-49-6742-01A\" \"TCGA-49-6742-11A\" \"TCGA-49-6744-01A\" \"TCGA-49-6744-11A\"\n#&gt;  [9] \"TCGA-49-6745-01A\" \"TCGA-49-6745-11A\" \"TCGA-50-5066-01A\" \"TCGA-50-5066-02A\"\n#&gt; [13] \"TCGA-50-5935-01A\" \"TCGA-50-5935-11A\" \"TCGA-50-5936-01A\" \"TCGA-50-5936-11A\"\nsample$sample_id\n#&gt;  [1] \"TCGA-44-6145-01A\" \"TCGA-44-6145-11A\" \"TCGA-44-6148-01A\" \"TCGA-44-6148-11A\"\n#&gt;  [5] \"TCGA-49-6742-01A\" \"TCGA-49-6742-11A\" \"TCGA-49-6744-01A\" \"TCGA-49-6744-11A\"\n#&gt;  [9] \"TCGA-49-6745-01A\" \"TCGA-49-6745-11A\" \"TCGA-50-5066-01A\" \"TCGA-50-5066-02A\"\n#&gt; [13] \"TCGA-50-5935-01A\" \"TCGA-50-5935-11A\" \"TCGA-50-5936-01A\" \"TCGA-50-5936-11A\"\n\nall(sample$sample_id%in% colnames(exprCounts))\n#&gt; [1] TRUE\nall(sample$SampleID == colnames(exprCounts))\n#&gt; [1] TRUE",
    "crumbs": [
      "下游分析",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>差异表达基因分析</span>"
    ]
  },
  {
    "objectID": "DEGs_Analysis.html#构造deg实例",
    "href": "DEGs_Analysis.html#构造deg实例",
    "title": "\n5  差异表达基因分析\n",
    "section": "\n5.4 构造DEG实例",
    "text": "5.4 构造DEG实例\n\nCodedim(exprCounts)\n#&gt; [1] 46488    16\ndim(sample)\n#&gt; [1] 16  3\nexprCounts &lt;- ceiling(exprCounts)\n\n\n根据TCGA样本的命名可以区分正常组织和肿瘤样本的测序结果 其中编号01-09表示肿瘤，10-19表示正常\n\nCode# 字符14~15，\nsample$condition &lt;- factor(\n ifelse(as.numeric(str_sub(sample$sample_id,14,15)) &lt; 10,'tumor','normal'),\n levels = c(\"normal\",\"tumor\"),\n ) \n\nsample &lt;- column_to_rownames(sample,var =\"sample_id\" )\nsample\n\n\n\n\n\nradiation_therapy\nkras_mutation_found\ncondition\n\n\n\nTCGA-44-6145-01A\nNO\nNO\ntumor\n\n\nTCGA-44-6145-11A\nNO\nNO\nnormal\n\n\nTCGA-44-6148-01A\nNO\nNO\ntumor\n\n\nTCGA-44-6148-11A\nNO\nNO\nnormal\n\n\nTCGA-49-6742-01A\nNO\nNO\ntumor\n\n\nTCGA-49-6742-11A\nNO\nNO\nnormal\n\n\nTCGA-49-6744-01A\nNO\nYES\ntumor\n\n\nTCGA-49-6744-11A\nNO\nYES\nnormal\n\n\nTCGA-49-6745-01A\nNO\nNO\ntumor\n\n\nTCGA-49-6745-11A\nNO\nNO\nnormal\n\n\nTCGA-50-5066-01A\nNO\nNO\ntumor\n\n\nTCGA-50-5066-02A\nNO\nNO\ntumor\n\n\nTCGA-50-5935-01A\nYES\nYES\ntumor\n\n\nTCGA-50-5935-11A\nYES\nYES\nnormal\n\n\nTCGA-50-5936-01A\nNO\nYES\ntumor\n\n\nTCGA-50-5936-11A\nNO\nYES\nnormal\n\n\n\n\n\n\n\nCodelibrary(DESeq2)\n\ndds &lt;- DESeqDataSetFromMatrix(countData = exprCounts,\n                              colData = sample,\n                              design = ~ condition)\ndds\n#&gt; class: DESeqDataSet \n#&gt; dim: 46488 16 \n#&gt; metadata(1): version\n#&gt; assays(1): counts\n#&gt; rownames(46488): TSPAN6 TNMD ... LINC01144 RP11-418H16.1\n#&gt; rowData names(0):\n#&gt; colnames(16): TCGA-44-6145-01A TCGA-44-6145-11A ... TCGA-50-5936-01A\n#&gt;   TCGA-50-5936-11A\n#&gt; colData names(3): radiation_therapy kras_mutation_found condition\n\n\n\n5.4.1 预过滤\n\nCodesmallestGroupSize &lt;- 8\n\nkeep &lt;- rowSums(counts(dds) &gt;= 10) &gt;= smallestGroupSize\ndds &lt;- dds[keep,]\ndds\n#&gt; class: DESeqDataSet \n#&gt; dim: 19562 16 \n#&gt; metadata(1): version\n#&gt; assays(1): counts\n#&gt; rownames(19562): TSPAN6 DPM1 ... RP11-274B21.13 LINC01144\n#&gt; rowData names(0):\n#&gt; colnames(16): TCGA-44-6145-01A TCGA-44-6145-11A ... TCGA-50-5936-01A\n#&gt;   TCGA-50-5936-11A\n#&gt; colData names(3): radiation_therapy kras_mutation_found condition\n\n\n\nCodedds$condition\n#&gt;  [1] tumor  normal tumor  normal tumor  normal tumor  normal tumor  normal\n#&gt; [11] tumor  tumor  tumor  normal tumor  normal\n#&gt; Levels: normal tumor\n\ndds@colData\n#&gt; DataFrame with 16 rows and 3 columns\n#&gt;                  radiation_therapy kras_mutation_found condition\n#&gt;                        &lt;character&gt;         &lt;character&gt;  &lt;factor&gt;\n#&gt; TCGA-44-6145-01A                NO                  NO    tumor \n#&gt; TCGA-44-6145-11A                NO                  NO    normal\n#&gt; TCGA-44-6148-01A                NO                  NO    tumor \n#&gt; TCGA-44-6148-11A                NO                  NO    normal\n#&gt; TCGA-49-6742-01A                NO                  NO    tumor \n#&gt; ...                            ...                 ...       ...\n#&gt; TCGA-50-5066-02A                NO                  NO    tumor \n#&gt; TCGA-50-5935-01A               YES                 YES    tumor \n#&gt; TCGA-50-5935-11A               YES                 YES    normal\n#&gt; TCGA-50-5936-01A                NO                 YES    tumor \n#&gt; TCGA-50-5936-11A                NO                 YES    normal\nhead(counts(dds)) #  19562   ×   16 \n#&gt;          TCGA-44-6145-01A TCGA-44-6145-11A TCGA-44-6148-01A TCGA-44-6148-11A\n#&gt; TSPAN6               1407              783             4794             3163\n#&gt; DPM1                 1293             1003              982             1158\n#&gt; SCYL3                 758              389              985              885\n#&gt; C1orf112              340               74              173              183\n#&gt; FGR                   747             3617              759             3076\n#&gt; CFH                  5718             2611            30270             8703\n#&gt;          TCGA-49-6742-01A TCGA-49-6742-11A TCGA-49-6744-01A TCGA-49-6744-11A\n#&gt; TSPAN6               3275             1696             2798             1360\n#&gt; DPM1                  922              986             1453              846\n#&gt; SCYL3                 838              498              808              514\n#&gt; C1orf112              261               95              271              119\n#&gt; FGR                   286             2126             1470             2712\n#&gt; CFH                  1574             5208             5880             3922\n#&gt;          TCGA-49-6745-01A TCGA-49-6745-11A TCGA-50-5066-01A TCGA-50-5066-02A\n#&gt; TSPAN6               2700             2194             3589             8759\n#&gt; DPM1                 1159             1584             2848             4398\n#&gt; SCYL3                 555              570              602             2118\n#&gt; C1orf112              386               98              483             1518\n#&gt; FGR                  1065             1631              541             1169\n#&gt; CFH                  6554             4153             2071             9081\n#&gt;          TCGA-50-5935-01A TCGA-50-5935-11A TCGA-50-5936-01A TCGA-50-5936-11A\n#&gt; TSPAN6               2199             1202             2537              725\n#&gt; DPM1                 1129              715              621              769\n#&gt; SCYL3                1349              441              556              553\n#&gt; C1orf112              386               60              346               80\n#&gt; FGR                   560             1831              519             3600\n#&gt; CFH                  1869             3667             4488             1881",
    "crumbs": [
      "下游分析",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>差异表达基因分析</span>"
    ]
  },
  {
    "objectID": "DEGs_Analysis.html#差异分析",
    "href": "DEGs_Analysis.html#差异分析",
    "title": "\n5  差异表达基因分析\n",
    "section": "\n5.5 差异分析",
    "text": "5.5 差异分析\n\nCodedes &lt;- DESeq(dds)\n\nresults &lt;- results(\n  object = des,\n  contrast = c(\"condition\", \"tumor\", \"normal\"),\n  alpha = 0.05,\n  filter = rowMeans(counts(des, normalized = TRUE)),# 独立过滤\n  theta = c(0.025, 0.975),\n  pAdjustMethod = \"BH\",\n)\nmetadata(results)[\"alpha\"]\n#&gt; $alpha\n#&gt; [1] 0.05\n\nresults[1:6,]\n#&gt; log2 fold change (MLE): condition tumor vs normal \n#&gt; Wald test p-value: condition tumor vs normal \n#&gt; DataFrame with 6 rows and 6 columns\n#&gt;           baseMean log2FoldChange     lfcSE      stat      pvalue        padj\n#&gt;          &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;\n#&gt; TSPAN6    2491.784       1.009957  0.284407   3.55110 3.83631e-04 2.72195e-03\n#&gt; DPM1      1318.670       0.500631  0.336588   1.48737 1.36918e-01 2.72805e-01\n#&gt; SCYL3      734.633       0.605618  0.202489   2.99087 2.78184e-03 1.38997e-02\n#&gt; C1orf112   268.645       1.951846  0.287025   6.80026 1.04432e-11 7.96688e-10\n#&gt; FGR       1655.039      -1.947828  0.290586  -6.70310 2.04049e-11 1.44134e-09\n#&gt; CFH       5564.337       0.608888  0.464523   1.31078 1.89932e-01 3.45383e-01\nsummary(results)\n#&gt; \n#&gt; out of 19562 with nonzero total read count\n#&gt; adjusted p-value &lt; 0.05\n#&gt; LFC &gt; 0 (up)       : 3248, 17%\n#&gt; LFC &lt; 0 (down)     : 2160, 11%\n#&gt; outliers [1]       : 0, 0%\n#&gt; low counts [2]     : 490, 2.5%\n#&gt; (mean count &lt; 13)\n#&gt; [1] see 'cooksCutoff' argument of ?results\n#&gt; [2] see 'independentFiltering' argument of ?results\nsum(results$padj &lt; 0.05, na.rm=TRUE)\n#&gt; [1] 5408\n\n# 根据padj 升序\nresOrdered &lt;- results[order(results$padj),]\n\n\n\n5.5.1 保存结果\n保存csv以备热图、火山图、富集分析。\n\nCodex &lt;- as.data.frame(resOrdered) |&gt; rownames_to_column(var = \"gene\")\nwrite_csv(x, file=\"data/resOrdered.csv\")\n\n\n\nCodemcols(resOrdered)$description\n#&gt; [1] \"mean of normalized counts for all samples\"        \n#&gt; [2] \"log2 fold change (MLE): condition tumor vs normal\"\n#&gt; [3] \"standard error: condition tumor vs normal\"        \n#&gt; [4] \"Wald statistic: condition tumor vs normal\"        \n#&gt; [5] \"Wald test p-value: condition tumor vs normal\"     \n#&gt; [6] \"BH adjusted p-values\"\n\n\npvalue，是统计学检验变量，代表差异显著性，一般认为P &lt; 0.05 为显著， P &lt;0.01 为非常显著。其含义为：由抽样误差导致样本间差异的概率小于0.05 或0.01。\npadj，是对pvalue进行多重假设检验校正后的结果。转录组测序的差异表达分析是对大量的基因表达值进行的独立统计假设检验，存在假阳性（Family-Wise Error Rate，FWER），Bonferroni矫正\nqvalue，False Discovery Rate，FDR，所有假阳性结果占所有拒绝零假设结果的比例，假阳性结果的比例不超过预设的FDR水平（0.05/0.1）,基于pvalue的分布。多重假设检验校正方法：Benjamini-Hochberg，\nlog2FoldChange：对数倍数变化，1.5倍差异即0.585，2倍差异即1。\n\n\n\n\n\nCodeDEG &lt;- read_csv(\"data/resOrdered.csv\")\n\nDESeq2_DEG &lt;- na.omit(DEG) \nnrDEG &lt;- DESeq2_DEG\nnrDEG[1:25,]\n\n\n\n\n\n\n\n\n\n\n\n\n\ngene\nbaseMean\nlog2FoldChange\nlfcSE\nstat\npvalue\npadj\n\n\n\nMGAT3\n1412.43862\n-4.320278\n0.2750470\n-15.707414\n0\n0\n\n\nRTKN2\n5130.81804\n-4.640307\n0.3175103\n-14.614667\n0\n0\n\n\nGPM6A\n1228.70589\n-5.145635\n0.3599700\n-14.294621\n0\n0\n\n\nSERTM1\n298.17214\n-6.886260\n0.5455626\n-12.622309\n0\n0\n\n\nLIMS2\n1926.05684\n-2.660279\n0.2146619\n-12.392878\n0\n0\n\n\nEMP2\n31710.06920\n-2.671839\n0.2229468\n-11.984199\n0\n0\n\n\nCNTN6\n352.36029\n-4.393899\n0.3796112\n-11.574736\n0\n0\n\n\nKANK3\n495.11283\n-2.848364\n0.2522794\n-11.290513\n0\n0\n\n\nRP1-78O14.1\n240.67218\n-4.394661\n0.3899644\n-11.269390\n0\n0\n\n\nGPM6B\n796.26123\n-2.528567\n0.2297754\n-11.004520\n0\n0\n\n\nWNT3A\n280.08606\n-5.270964\n0.4854622\n-10.857621\n0\n0\n\n\nPDLIM2\n1757.53896\n-2.207799\n0.2064731\n-10.692915\n0\n0\n\n\nITLN2\n655.86747\n-5.904468\n0.5588234\n-10.565893\n0\n0\n\n\nSLC6A13\n35.46976\n-3.659195\n0.3472796\n-10.536740\n0\n0\n\n\nGRK5\n2389.94916\n-2.795107\n0.2712779\n-10.303480\n0\n0\n\n\nEDNRB\n3236.38793\n-3.288481\n0.3211332\n-10.240242\n0\n0\n\n\nKCNN4\n1240.55071\n3.836884\n0.3783283\n10.141679\n0\n0\n\n\nCLIC5\n8327.11939\n-3.732657\n0.3685299\n-10.128505\n0\n0\n\n\nRASAL1\n261.44562\n4.538838\n0.4504928\n10.075272\n0\n0\n\n\nRP11-371A19.2\n54.44687\n-5.168047\n0.5162906\n-10.009957\n0\n0\n\n\nPTPN21\n2327.21817\n-2.527771\n0.2538084\n-9.959365\n0\n0\n\n\nCLEC3B\n2091.74017\n-4.223742\n0.4294719\n-9.834733\n0\n0\n\n\nCTD-2135D7.5\n38.21341\n-3.366170\n0.3434858\n-9.800029\n0\n0\n\n\nFAM83A\n2565.85011\n6.377845\n0.6514036\n9.790927\n0\n0\n\n\nPTPRH\n490.58361\n6.130422\n0.6281505\n9.759480\n0\n0\n\n\n\n\n\n\n\n5.5.2 热图\n\nCode\nlog2exprCounts &lt;- log2(counts(des)+1)\nlibrary(pheatmap)\n\npheatmap(log2exprCounts[(head(DESeq2_DEG$gene,n=25)) , ])\n\n\n\n\n\n\n\n\n5.5.3 配对图\n挑选指定第一个基因看它在同一个病人的配对表达情况\n\nCodelibrary(ggpubr)\n\ndf &lt;- tibble(\n  group = sample$condition,\n  patient = colnames(exprCounts),\n  expressionValue = as.numeric(exprCounts[DESeq2_DEG$gene[1],]),\n  )\n\nggpubr::ggpaired(df, x = \"group\", y = \"expressionValue\",color = \"group\", \n                 line.color = \"gray\", line.size = 0.4,palette = \"npg\")+\n    stat_compare_means()\n\n\n\n\n\n\n\n\n5.5.4 火山图\n\nCodenrDEG$group &lt;- factor(\n    if_else(nrDEG$padj&lt;0.05& abs(nrDEG$log2FoldChange)&gt;=1,\n            if_else(nrDEG$log2FoldChange&gt;=1,\"up\",\"down\"),\n            \"NS\",),\n    levels =c(\"up\",\"down\",\"NS\") )\ntable(nrDEG$group)\n#&gt; \n#&gt;    up  down    NS \n#&gt;  2073  1641 15358\n\ngene_labels &lt;- dplyr::filter(nrDEG,nrDEG$padj&lt;0.05 & \n                                 abs(nrDEG$log2FoldChange)&gt;=1)|&gt; \n    slice_head(n=25) \n\n\nggplot(nrDEG,aes( x = log2FoldChange,y = -log10(padj),color=group,shape=group))+\n    geom_point(alpha=0.5,size=1.5)+\n    scale_color_manual(values = c(\"red\",\"green\",\"gray\"))+\n    #scale_shape_manual(values = c(2,25,4))+\n    geom_vline(xintercept = c(-1,0,1),lty=3,color=\"grey25\",lwd=0.8)+\n    geom_hline(yintercept = -log10(0.05),lty=3,color=\"grey25\",lwd=0.8)+\n    ggrepel::geom_text_repel(\n        data = gene_labels,\n        aes(label=gene),\n        color=\"black\",\n        size=2)+\n    theme_pubr()\n\n\n\n\n\n\n\n\n5.5.5 EnhancedVolcano\n\n\nCodeif(!require(EnhancedVolcano))\n  BiocManager::install('EnhancedVolcano')\n\n\n\n5.5.6 LFC收缩和pagj\n\nCoderesultsNames(des)\n#&gt; [1] \"Intercept\"                 \"condition_tumor_vs_normal\"\n# BiocManager::install(\"apeglm\")  自适应 t 先验收缩估计器  默认\n# resLFC &lt;- lfcShrink(des, coef=\"condition_tumor_vs_normal\", type=\"apeglm\")\n\n# `normal`是原始的 DESeq2 收缩估计器，是先验的自适应正态分布\nresNorm &lt;- lfcShrink(des, coef=2, type=\"normal\")\n\n# BiocManager::install(\"ashr\")\n# resAsh &lt;- lfcShrink(des, coef=2, type=\"ashr\")\n\n\n## 先验信息\n\n# priorInfo(resLFC)\npriorInfo(resNorm)\n#&gt; $type\n#&gt; [1] \"normal\"\n#&gt; \n#&gt; $package\n#&gt; [1] \"DESeq2\"\n#&gt; \n#&gt; $version\n#&gt; [1] '1.44.0'\n#&gt; \n#&gt; $betaPriorVar\n#&gt;      Intercept conditiontumor \n#&gt;   1.000000e+06   1.658755e+00\n# priorInfo(resAsh)\n\n\n\n5.5.7 MA图 Mean-AbsDeviation plot\n\nCode# 对gene添加“是否呈现显著差异表达”的标签\nDESeq2_DEG$significant &lt;- factor(ifelse(DESeq2_DEG$padj &lt;0.05, \"Significant\", \"NS\"),\nlevels = c(\"Significant\", \"NS\"))\n\ntable(DESeq2_DEG$significant)\n#&gt; \n#&gt; Significant          NS \n#&gt;        5408       13664\n# 以baseMean作为x，log2FoldChange作为y   以significant作为分类变量\nggplot(DESeq2_DEG, aes(baseMean, log2FoldChange, colour=significant)) + \n geom_point(size=1) + \n scale_y_continuous(limits=c(-3, 3)) + \n scale_x_log10() + \n geom_hline(yintercept = 0, colour=\"black\", linewidth=1) + \n labs(x=\"mean of normalized counts\", y=\"log2FoldChange\") + \n scale_colour_manual(name=\"padj\", \n                     values=c(\"Significant\"=\"blue\",\"NS\"=\"grey50\")) +\n theme_classic()\n\n\n\n\n\n\n\n\nCodexlim &lt;- c(1,10e6)\nylim &lt;- c(-3,3)\nplotMA(resOrdered,  xlim=xlim, ylim=ylim,main=\"none\")\n\n\n\n\n\n\nCode# plotMA(resLFC, xlim=xlim, ylim=ylim, main=\"apeglm\")\nplotMA(resNorm, xlim=xlim, ylim=ylim, main=\"normal\")\n\n\n\n\n\n\nCode# plotMA(resAsh, xlim=xlim, ylim=ylim, main=\"ashr\")\n\n\n\n5.5.8 readCounts\n\nCode#  the counts of reads for a single gene across the groups\nplotCounts(des, gene=which.min(resOrdered$padj), \n  intgroup=\"condition\",returnData=TRUE) |&gt; \n ggplot(aes(x=condition, y=count)) + \n geom_point(position=position_jitter(w=0.1,h=0))\n\n\n\n\n\n\n\n\n5.5.9 异常观测\n\nCodeW &lt;- resOrdered$stat\nmaxCooks &lt;- apply(assays(des)[[\"cooks\"]],1,max)\nidx &lt;- !is.na(W)\nplot(rank(W[idx]), maxCooks[idx], xlab=\"rank of Wald statistic\", \n  ylab=\"maximum Cook's distance per gene\",\n  ylim=c(0,5), cex=.4, col=rgb(0,0,0,.3))\nm &lt;- ncol(des)\np &lt;- 3\nabline(h=qf(.99, p, m - p))\n\n\n\n\n\n\n\n\n5.5.10 多因素设计\n\nCodecolData(dds)\n#&gt; DataFrame with 16 rows and 3 columns\n#&gt;                  radiation_therapy kras_mutation_found condition\n#&gt;                        &lt;character&gt;         &lt;character&gt;  &lt;factor&gt;\n#&gt; TCGA-44-6145-01A                NO                  NO    tumor \n#&gt; TCGA-44-6145-11A                NO                  NO    normal\n#&gt; TCGA-44-6148-01A                NO                  NO    tumor \n#&gt; TCGA-44-6148-11A                NO                  NO    normal\n#&gt; TCGA-49-6742-01A                NO                  NO    tumor \n#&gt; ...                            ...                 ...       ...\n#&gt; TCGA-50-5066-02A                NO                  NO    tumor \n#&gt; TCGA-50-5935-01A               YES                 YES    tumor \n#&gt; TCGA-50-5935-11A               YES                 YES    normal\n#&gt; TCGA-50-5936-01A                NO                 YES    tumor \n#&gt; TCGA-50-5936-11A                NO                 YES    normal",
    "crumbs": [
      "下游分析",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>差异表达基因分析</span>"
    ]
  }
]